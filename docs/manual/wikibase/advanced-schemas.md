データが単純な表ではなかったり、行ごとに追加したいステートメントの種類が変わる場合があります。本ドキュメントでは、そうしたケースに対応する方法を紹介します。

## 階層データ {#hierarchical-data}

ソースが XML や JSON、RDF のような構造化形式で提供されることがあります。OpenRefine はこれらをインポートし、表に変換します。この表は [レコードモード](manual/exploring.md#rows-vs-records) を用いて null セルで階層構造を表現します。

Wikibase 拡張は常に行モードで動作するため、アーティストと曲を同時に参照するステートメントを追加したい場合は、null セルを適切なアーティストで埋める必要があります。対象列の **Edit cells** → **Fill down** を使えば、セル値だけでなくリコンサイル結果も含めてコピーできます。

## 条件付きでの追加 {#conditional-additions}

特定の条件を満たす行にだけステートメントを追加したい場合があります。

ワークフローの一例:
- 追加したくない行をファセットで絞り込む
- 追加対象の列を空にする（情報を残したい場合は事前に列を複製）
- ファセットを解除して全行を再表示
- 空にした列をステートメント値としてスキーマを構築

## プロパティが行によって異なる場合 {#varying-properties}

スキーマ内でプロパティを列変数に置き換えたいことがありますが、現在は実現できません。プロパティ用のリコンサイルサービスが存在しないことに加えて、プロパティが行ごとに変わるとデータ型が揃わず、スキーマ構造が崩れてしまうためです。

使用するプロパティが少数であれば、次のように回避できます。例として、1 列目に高度、2 列目に [operating altitude (P2254)](https://www.wikidata.org/wiki/Property:P2254) として追加すべきか、[elevation above sea level (P2044)](https://www.wikidata.org/wiki/Property:P2044) として追加すべきかを示す列があるとします。

まず 1 列目にテキストファセットを作成し、*altitude* の行だけ残します。次に 2 列目を元に新しい列を追加します（既定式 `value` のままで複製）。続いてファセットで *maximum operating altitude* を選び、同様に複製します。ファセットをリセットすると、元の列が 2 つの列に分割されているはずです。これら 2 列を使って 2 つのステートメントをスキーマに追加すれば、空の値は無視されるため各アイテムにつき望んだプロパティのステートメントが 1 件だけ作成されます。

## Wikibase 上の既存データに合わせる {#adapting-to-existing-data-on-wikibase}

すでにステートメントが存在する場合は新規追加しないようにしたいことがあります。以下はその一例です。

1. **Edit columns → Add columns from reconciled values** で Wikidata の既存値を取得
2. 取得した列に *facet by null* を作成
3. 非 null 行（値が **false**）を選択
4. ソース値を持つ列を **Edit cells → Common transformations → To null** でクリア

あとは通常どおりスキーマを構築すれば、null のセルは無視されるため、既存データがあるアイテムには追加されません。
